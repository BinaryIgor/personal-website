<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/css/styles.css">
    <title>Igor Roztropiński</title>
    <meta property="description" content="Some description" />
    <meta name="author" content="Igor Roztropiński" />
    <script>
        (function () {
            const KEY = "MODE";
            const LIGHT_MODE = 'light';
            const DARK_MODE = 'dark';

            const currentMode = () => {
                const mode = localStorage.getItem(KEY);
                if (mode) {
                    return mode;
                }
                return DARK_MODE;
            }

            const setDarkMode = () => {
                document.documentElement.classList.add(DARK_MODE);
            };

            const setLightMode = () => {
                document.documentElement.classList.remove(DARK_MODE);
            };

            const mode = currentMode();
            switch (mode) {
                case LIGHT_MODE:
                    setLightMode();
                    break;
                case DARK_MODE:
                    setDarkMode();
                    break;
            }
        })();
    </script>
</head>

<body>
    <nav class="top-nav fade-in hidden">
        <a href="home" class="nav-item left-underline">Home</a>
        <a href="about" class="nav-item left-underline">About</a>
        <a href="skills" class="nav-item left-underline">Skills</a>
        <a href="experience" class="nav-item left-underline">Experience</a>
        <a href="code" class="nav-item left-underline">Code</a>

        <div class="theme-mode"><img class="theme-mode-image"
                src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D" alt=""></div>
        <div id="nav-mobile-menu">Menu</div>
    </nav>

    <nav class="top-nav-mobile fade-in hidden">
        <span class="nav-mobile-close">
            &#x2715;
        </span>

        <div class="nav-mobile-list">
            <ul>
                <li class="nav-mobile-list-item">
                    <a href="home" class="left-underline">Home</a>
                </li>
                <li class="nav-mobile-list-item">
                    <a href="about" class="left-underline">About</a>
                </li>
                <li class="nav-mobile-list-item">
                    <a href="skills" class="left-underline">Skills</a>
                </li>
                <li class="nav-mobile-list-item">
                    <a href="experience" class="left-underline">Experience</a>
                </li>
                <li class="nav-mobile-list-item">
                    <a href="code" class="left-underline">Code</a>
                </li>
            </ul>
        </div>
    </nav>

    <canvas id="canvas"></canvas>

    <div id="component" class="fade-in hidden"></div>

    <script>
        const URL_PROPERTY_REGEX = /url\((.*)\)/;

        function extractedImageSrc(cssVar) {
            return getComputedStyle(document.body)
                .getPropertyValue(`--${cssVar}`)
                .match(URL_PROPERTY_REGEX)[1]
                .replace(/"/g, "")
                .replace(/'/g, "");
        }

        function setupMode() {
            const KEY = "MODE";
            const LIGHT_MODE = 'light';
            const DARK_MODE = 'dark';

            const darkThemeIconSrc = extractedImageSrc('theme-dark-icon');
            const lightThemeIconSrc = extractedImageSrc('theme-light-icon');

            const topNav = document.querySelector(".top-nav");
            const themeModeImage = document.querySelector('.theme-mode-image');
            const topNavMobile = document.querySelector('.top-nav-mobile');
            const navMobile = document.getElementById('nav-mobile-menu');
            const navMobileClose = document.querySelector('.nav-mobile-close');

            const currentMode = () => {
                const mode = localStorage.getItem(KEY);
                if (mode) {
                    return mode;
                }
                return DARK_MODE;
            }

            const setDarkMode = () => {
                document.documentElement.classList.add(DARK_MODE);
                localStorage.setItem(KEY, DARK_MODE)
                setDarkImages();
            };

            const setDarkImages = () => {
                themeModeImage.src = lightThemeIconSrc;
            };

            const setLightImages = () => {
                themeModeImage.src = darkThemeIconSrc;
            };

            const setLightMode = () => {
                document.documentElement.classList.remove(DARK_MODE);
                localStorage.setItem(KEY, LIGHT_MODE)
                setLightImages();
            };

            const mode = currentMode();
            switch (mode) {
                case LIGHT_MODE:
                    setLightMode();
                    break;
                case DARK_MODE:
                    setDarkMode();
                    break;
            }

            themeModeImage.addEventListener('click', e => {
                switch (currentMode()) {
                    case LIGHT_MODE:
                        setDarkMode();
                        break;
                    default:
                        setLightMode();
                        break;
                }
                document.dispatchEvent(new Event("themeChange"));    
            });

            navMobile.addEventListener('click', () => {
                topNavMobile.classList.add('display');
                // document.body.classList.add("modal-open");
            });

            topNav.addEventListener("click", e => e.stopPropagation());

            navMobileClose.addEventListener('click', function () {
                topNavMobile.classList.remove('display');
                document.body.classList.remove("modal-open");
            });
        }

        setupMode();
    </script>
    <script type="module" src="/js/app.js">
    </script>
</body>

</html>